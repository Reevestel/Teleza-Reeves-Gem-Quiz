<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Teleza Reeves — GEMS Quiz</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#07060a" />
  <style>
    :root{
      /* Brand palette (NOT gold/black) */
      --bg:#07060a;
      --bg-card:#121017;
      --fg:#ffffff;
      --muted:#c9c4d4;

      --brand:#a78bfa;
      --brand-soft:#f9a8d4;
      --brand-ivory:#f5f2ff;
      --border-soft:rgba(255,255,255,.18);

      /* gem colors */
      --sapphire:#2bb3ff;
      --ruby:#ff3b3b;
      --pearl:#ffd7f2;
      --emerald:#30d985;

      --shadow: 0 14px 40px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    html,body{
      margin:0;padding:0;
      background:radial-gradient(circle at top,#1a1224 0,var(--bg) 60%);
      color:var(--fg);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }
    body{min-height:100vh;display:flex;flex-direction:column}

    header{
      padding:20px 16px 14px;
      border-bottom:1px solid rgba(255,255,255,.12);
      text-align:center;
      position:sticky;top:0;z-index:5;
      backdrop-filter:blur(12px);
      background:linear-gradient(to bottom,rgba(7,6,10,.95),rgba(7,6,10,.85));
    }
    .brand{
      font-weight:900;
      font-size:14px;
      letter-spacing:1.4px;
      text-transform:uppercase;
      background:linear-gradient(90deg,var(--brand),var(--brand-soft));
      -webkit-background-clip:text;background-clip:text;color:transparent;
    }
    h1{margin:4px 0 4px;font-size:clamp(22px,5vw,30px)}
    .sub{color:var(--muted);font-size:13px}

    .wrap{
      max-width:960px;margin:0 auto;width:100%;
      padding:16px;padding-bottom:60px;
    }
    .card{
      background:var(--bg-card);
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      padding:16px 14px;
      margin-bottom:12px;
      box-shadow:var(--shadow);
    }
    .card--glow{
      border:1px solid rgba(167,139,250,.55);
      box-shadow:0 0 22px rgba(249,168,212,.12);
    }

    .meta{color:var(--muted);font-size:13px;line-height:1.45}
    .q{font-weight:700;margin-bottom:10px;font-size:15px}

    .quiz-layout{
      display:grid;
      grid-template-columns:minmax(0,1fr);
      gap:12px;
    }
    @media (min-width:800px){
      .quiz-layout{grid-template-columns:minmax(0,1.4fr) minmax(0,1fr)}
    }

    .progress-shell{margin:10px 0 14px;font-size:12px;color:var(--muted)}
    .progress-label-row{
      display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;
      gap:12px;flex-wrap:wrap;
    }
    .progress-bar{
      width:100%;height:7px;border-radius:999px;
      background:rgba(255,255,255,.07);
      overflow:hidden;
    }
    .progress-fill{
      height:100%;width:0;border-radius:999px;
      background:linear-gradient(90deg,var(--brand),var(--brand-soft));
      transition:width .18s ease-out;
    }

    .answers{display:grid;gap:8px}
    .answer{
      display:flex;align-items:flex-start;gap:10px;
      padding:10px 12px;border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(90deg,rgba(255,255,255,.04),rgba(0,0,0,.4));
      cursor:pointer;font-size:14px;
      transition:border-color .15s ease, background .15s ease, transform .08s ease;
      -webkit-tap-highlight-color:transparent;
      user-select:none;
    }
    .answer:hover{border-color:rgba(249,168,212,.85)}
    .answer.selected{
      border-color:rgba(167,139,250,.95);
      background:radial-gradient(circle at left,rgba(167,139,250,.18),rgba(0,0,0,.6));
      transform:translateY(-1px);
    }
    .answer input{
      margin-top:2px;
      accent-color:var(--brand);
      transform:scale(1.12);
      cursor:pointer;
    }

    .buttons{display:flex;gap:8px;flex-wrap:wrap;margin:14px 0 4px}
    button{
      border-radius:999px;border:none;
      padding:9px 18px;
      font-weight:800;font-size:13px;
      text-transform:uppercase;letter-spacing:.5px;
      cursor:pointer;
    }
    button:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:linear-gradient(90deg,var(--brand),var(--brand-soft));color:#0f0b17}
    .btn-secondary{background:transparent;color:var(--fg);border:1px solid rgba(255,255,255,.3)}

    .result{
      padding:14px 14px 16px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background:radial-gradient(circle at top left,rgba(167,139,250,.14),#0b0a10);
      display:none;
      box-shadow:var(--shadow);
    }
    .result-title{font-size:18px;font-weight:800;margin-bottom:4px}

    .pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 9px;border-radius:999px;
      border:1px solid rgba(255,255,255,.24);
      font-size:11px;text-transform:uppercase;letter-spacing:.5px;
      margin-bottom:6px;
    }
    .dot{width:10px;height:10px;border-radius:999px;background:var(--brand)}

    .bars{margin-top:8px;display:grid;gap:8px}
    .bar-row{display:flex;align-items:center;gap:8px;font-size:13px}
    .bar-label{width:80px;text-transform:uppercase;font-weight:700;font-size:11px}
    .bar-shell{flex:1;height:14px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden}
    .bar-fill{height:100%;width:0;border-radius:999px}
    .bar-val{width:42px;text-align:right;font-weight:700;font-size:12px}

    .section-title{margin-top:10px;font-size:14px;font-weight:800}
    .bullets{margin:4px 0 0;padding-left:18px;font-size:13px;color:var(--muted)}
    .bullets li{margin-bottom:3px}

    .profile-tools{margin-top:10px;display:none}
    .profile-row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:8px}

    .profile-tools input[type="text"]{
      background:#0b0b12;border-radius:10px;
      border:1px solid rgba(255,255,255,.2);
      padding:8px 9px;font-size:13px;color:var(--fg);
      min-width:180px;outline:none;
    }
    .profile-tools input[type="text"]::placeholder{color:rgba(201,196,212,.7)}
    .profile-tools input[type="file"]{font-size:12px;color:var(--muted)}

    .preview{
      margin-top:10px;border-radius:16px;
      border:1px dashed rgba(255,255,255,.24);
      background:#05050a;padding:8px;text-align:center;
    }
    .preview img{max-width:100%;border-radius:14px;display:block;margin:0 auto}

    .footer{
      text-align:center;font-size:11px;color:var(--muted);
      padding:10px 16px 18px;margin-top:auto;opacity:.85;
    }
    .badge-legal{
      font-size:10px;text-transform:uppercase;letter-spacing:.5px;
      border-radius:999px;border:1px solid rgba(255,255,255,.2);
      padding:2px 6px;display:inline-block;margin-bottom:4px;
    }
  </style>
</head>

<body>
<header>
  <div class="brand">Teleza Reeves</div>
  <h1>GEMS Personality Quiz</h1>
  <div class="sub">Discover your dominant money-making personality: Sapphire • Ruby • Pearl • Emerald</div>
</header>

<div class="wrap">
  <div class="card card--glow">
    <div class="meta">
      This quiz is created by Teleza Reeves — to help you understand how you naturally move in money,
      business, and community. Choose the answer that sounds most like you <b>most of the time</b>.
    </div>
  </div>

  <div class="quiz-layout">
    <div>
      <div class="card">
        <div class="progress-shell">
          <div class="progress-label-row">
            <span id="progressText">Question 1 of 16</span>
            <span id="progressPercent">Answered 0/16 (0%)</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>

        <div id="questionContainer"></div>

        <div class="buttons">
          <button class="btn-secondary" id="prevBtn" type="button">Back</button>
          <button class="btn-primary" id="nextBtn" type="button">Next</button>
        </div>
      </div>
    </div>

    <div>
      <div id="resultPanel" class="result"></div>

      <div class="profile-tools" id="profileTools">
        <div class="card">
          <div class="q">Generate your share card</div>
          <div class="meta" style="margin-bottom:6px;">
            Perfect for Instagram / TikTok — 1080×1350 portrait. Add your name + optional brand tag + optional photo, then download as PNG.
          </div>

          <div class="profile-row">
            <input type="text" id="displayName" placeholder="Your name (optional)" maxlength="40" />
            <input type="text" id="brandTag" placeholder="@handle or tagline (optional)" maxlength="40" />
            <input type="file" id="photoInput" accept="image/*" />
            <button class="btn-primary" id="makeCard" type="button">Generate My Share Card</button>
          </div>

          <div class="profile-row">
            <button class="btn-secondary" id="downloadCard" type="button" style="display:none;">Download PNG</button>
          </div>

          <div class="preview" id="cardPreview" style="display:none;">
            <img id="cardImg" alt="Share card preview" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <span class="badge-legal">For personal insight only</span><br />
    Not medical, legal, or financial advice. © Teleza Reeves
  </div>
</div>

<script>
  /***********************
   * CONFIG + COPY DECK  *
   ***********************/
  const APP_CONFIG = {
    brand: {
      primary: getComputedStyle(document.documentElement).getPropertyValue("--brand").trim(),
      primarySoft: getComputedStyle(document.documentElement).getPropertyValue("--brand-soft").trim(),
      background: getComputedStyle(document.documentElement).getPropertyValue("--bg").trim(),
      fontFamily: "system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"
    },
    gems: {
      sapphire: {
        label: "Sapphire",
        colorVar: "--sapphire",
        description: "People-oriented • Active • Magnetic. You bring the fun, the story, and the vibe.",
        benefits: [
          "You attract people and attention effortlessly.",
          "You make experiences feel fun and memorable.",
          "You keep energy high in teams and communities.",
          "You’re a natural storyteller and promoter.",
          "You help people feel seen and included.",
          "You’re great at vision casting and hype.",
          "You’re flexible and open to new ideas.",
          "You inspire people to start and take action.",
          "You’re rarely boring — you bring flavor.",
          "You help brands feel human and alive."
        ],
        challenges: [
          "Finishing what you start when excitement wears off.",
          "Avoiding over-committing to too many ideas at once.",
          "Sticking with boring but necessary routines.",
          "Getting lost in vibes and neglecting structure.",
          "Under-estimating how long tasks actually take.",
          "Letting other people’s energy distract you.",
          "Avoiding detailed tracking of money and metrics.",
          "Procrastinating on unsexy admin tasks.",
          "Saying yes when you really mean no.",
          "Being consistent when you feel ‘off’ that day."
        ],
        tips: [
          "Use timers and short sprints to get through boring tasks.",
          "Partner with Emerald or Ruby types for structure and follow-through.",
          "Batch content on high-energy days, schedule it to post later.",
          "Keep a simple weekly scoreboard for money, content, and follow-ups.",
          "Create repeatable rituals so discipline feels like a vibe, not a punishment.",
          "Say yes only to what aligns with your bigger vision.",
          "Turn your stories into offers: always bring it back to a next step.",
          "Put deadlines on your ideas so they don’t float forever.",
          "Reward yourself with fun after completing focused work blocks.",
          "Remember: charisma opens doors, consistency keeps them open."
        ],
        howToWin: [
          "Lead from the front with energy — host lives, events, and launches.",
          "Own the role of storyteller: highlight transformation, not just features.",
          "Build a simple content ecosystem around your face, story, and lifestyle.",
          "Use visual systems (boards, sticky notes, simple dashboards).",
          "Collaborate with structured teammates so ideas become assets, not chaos.",
          "Monetize community: referrals, affiliate offers, group programs.",
          "Create ‘always-on’ offers in your bio so your audience can move anytime.",
          "Protect your energy with boundaries; not every invite deserves your time.",
          "Keep your brand look luxury + consistent so vibe matches value.",
          "Treat fun as a strategy: people buy the energy they want to feel."
        ]
      },
      ruby: {
        label: "Ruby",
        colorVar: "--ruby",
        description: "Task-oriented • Active • Competitive. You’re here to win, build, and scale.",
        benefits: [
          "You move fast and hate wasting time.",
          "You’re naturally driven by goals and milestones.",
          "You’re great at selling when you believe in the offer.",
          "You don’t shy away from pressure or big moves.",
          "You like clear targets and clear rewards.",
          "You can motivate a team to move now, not later.",
          "You’re decisive when others hesitate.",
          "You’re comfortable talking about money and results.",
          "You think in terms of impact, not just effort.",
          "You naturally step into leadership positions."
        ],
        challenges: [
          "Impatience with slower or more sensitive people.",
          "Pushing so hard you ignore your own emotional needs.",
          "Focusing only on numbers and forgetting relationships.",
          "Being harsh when giving feedback or direction.",
          "Getting bored once a goal is reached and not stabilizing.",
          "Seeing rest as weakness instead of strategy.",
          "Not celebrating small wins along the way.",
          "Under-listening because you already ‘know’ the answer.",
          "Taking on too much to prove you can handle it.",
          "Forgetting that sustainability beats sprints in the long run."
        ],
        tips: [
          "Use clear, visible scoreboards for your goals (income, recruits, sales).",
          "Schedule non-negotiable rest to protect long-term performance.",
          "Practice active listening so people feel led, not bulldozed.",
          "Pair with Pearl types to deepen relationships and retention.",
          "Reward progress, not just final outcomes.",
          "Document your winning moves into simple playbooks and scripts.",
          "Compete with your own best, not just others.",
          "Focus grind on a few key levers instead of scattered effort.",
          "Communicate expectations clearly so there’s no confusion.",
          "Remember: leadership is results + how people feel with you."
        ],
        howToWin: [
          "Set bold, clear money + impact goals with timelines.",
          "Design weekly power hours for revenue-moving actions only.",
          "Create urgency with confidence, not fear.",
          "Keep an inner circle that keeps your heart soft + standards high.",
          "Track closing rate, follow-ups, repeat buyers — optimize like a pro.",
          "Train others; don’t hoard the game.",
          "Build assets (scripts, funnels, templates) that scale ambition.",
          "Anchor grind to mission so it stays meaningful.",
          "Protect mornings for strategy, not chaos.",
          "Turn your fire into systems, not just sprints."
        ]
      },
      pearl: {
        label: "Pearl",
        colorVar: "--pearl",
        description: "People-oriented • Calm • Heart-led. You care deeply about impact, safety, and soul.",
        benefits: [
          "You make people feel safe, seen, and supported.",
          "You’re great at customer care and retention.",
          "You listen deeply and remember details about people.",
          "You value purpose and alignment over quick cash.",
          "You notice emotional undercurrents in groups.",
          "You are trusted with secrets and real stories.",
          "You create spaces that feel like home and healing.",
          "You’re drawn to meaningful, transformational work.",
          "You walk with people through process, not rush them.",
          "You keep the humanity inside business."
        ],
        challenges: [
          "Avoiding conflict even when boundaries are needed.",
          "Under-charging because you just want to help.",
          "Taking on other people’s emotions as your own.",
          "Feeling guilty when you talk about money or pricing.",
          "Over-giving and burning out silently.",
          "Struggling to say no to people you care about.",
          "Delaying decisions because you don’t want to hurt feelings.",
          "Fear of rejection stopping invitations to opportunities.",
          "Doing invisible emotional labor that goes unrewarded.",
          "Equating being ‘nice’ with never setting standards."
        ],
        tips: [
          "Write down prices + boundaries so you don’t negotiate against yourself.",
          "Being paid well lets you help more people, not fewer.",
          "Schedule emotional recovery after heavy sessions or events.",
          "Collaborate with Ruby types to practice bold invitations.",
          "Turn listening into testimonials and case studies.",
          "Practice short, firm no’s without over-explaining.",
          "Use scripts to invite people into offers confidently.",
          "Create offers that protect energy (groups, office hours, etc.).",
          "Let heart be part of marketing — it’s your superpower.",
          "Boundaries are love, including for yourself."
        ],
        howToWin: [
          "Position yourself as the safe, trusted guide in your space.",
          "Design transformation-focused offers, not just transactions.",
          "Use stories + testimonials to show the impact of your care.",
          "Charge for the change you create, not just hours.",
          "Systemize follow-up so you don’t carry it all mentally.",
          "Partner with Emerald types to build processes around your gifts.",
          "Create community containers you can lead from the heart.",
          "Set office hours so you don’t emotionally leak everywhere.",
          "Let money reflect the healing + impact you bring.",
          "Lead with compassion, protect capacity like a CEO."
        ]
      },
      emerald: {
        label: "Emerald",
        colorVar: "--emerald",
        description: "Task-oriented • Calm • Strategic. You see patterns, systems, and risk clearly.",
        benefits: [
          "You think in processes, not just moments.",
          "You naturally analyze before acting.",
          "You help teams reduce risk and chaos.",
          "You notice details others overlook.",
          "You’re great at documentation and SOPs.",
          "You bring calm structure into emotional spaces.",
          "You’re good with systems, tools, and dashboards.",
          "You turn messy ideas into clear plans.",
          "You value quality, integrity, and accuracy.",
          "You’re patient enough to build long-term foundations."
        ],
        challenges: [
          "Over-analyzing and delaying action.",
          "Feeling stuck until everything is ‘perfect’.",
          "Moving slow in messy, human spaces.",
          "Frustration with impulsive people.",
          "Avoiding visibility because you don’t feel ‘ready’.",
          "Planning more than executing.",
          "Being overly critical of yourself or your work.",
          "Under-sharing your genius because it feels obvious to you.",
          "Needing more data than the moment can give.",
          "Letting fear of mistakes block experimentation."
        ],
        tips: [
          "Set deadlines for decisions, not just research.",
          "Use 70% clarity as ‘enough to move’.",
          "Batch system-building so it doesn’t replace revenue actions.",
          "Pair with Sapphire/Ruby types to spark motion and visibility.",
          "Turn frameworks + checklists into products/services.",
          "Track the right numbers, not every number.",
          "Share behind-the-scenes thinking; people will call it genius.",
          "Run small controlled experiments to learn faster than theory.",
          "Design automations that protect time + mental load.",
          "Precision is powerful, but momentum compounds it."
        ],
        howToWin: [
          "Be the systems brain behind the brand or movement.",
          "Turn organization into templates, dashboards, structures others can use.",
          "Own back-end: operations, finances, tech, quality control.",
          "Create signature frameworks that become brand language.",
          "Make content that breaks complex ideas into simple visual steps.",
          "Package organization skills as consulting or done-for-you.",
          "Partner with visible personalities so systems get spotlighted.",
          "Protect deep-focus time for architecture and optimization.",
          "Document once so it can be reused many times.",
          "Lead with calm confidence: you keep the machine running."
        ]
      }
    },
    quiz: {
      title: "Teleza Reeves — GEMS Quiz",
      questions: [
        {
          text: "What gets you excited to start a new project?",
          options: {
            sapphire: "It sounds fun and I get to involve people.",
            ruby: "A clear challenge, competition, or prize to win.",
            pearl: "It helps or uplifts people I care about.",
            emerald: "There’s a plan, data, and a well-defined process."
          }
        },
        {
          text: "When making a decision, I usually…",
          options: {
            sapphire: "Go with my gut and keep the vibe positive.",
            ruby: "Choose quickly and move.",
            pearl: "Ask who will be affected and consider feelings.",
            emerald: "Weigh pros/cons and research first."
          }
        },
        {
          text: "At a social or business event, you can find me…",
          options: {
            sapphire: "Chatting with everyone and starting conversations.",
            ruby: "Networking with a purpose—making moves and connections.",
            pearl: "Checking in on people and making them comfortable.",
            emerald: "Having a thoughtful 1:1 conversation off to the side."
          }
        },
        {
          text: "My ideal work style looks like…",
          options: {
            sapphire: "Flexible, creative, and people-first.",
            ruby: "Fast paced, goal-driven, and results-focused.",
            pearl: "Supportive, collaborative, and service-oriented.",
            emerald: "Organized, detailed, and system-driven."
          }
        },
        {
          text: "Deadlines feel…",
          options: {
            sapphire: "Motivating if the project is exciting.",
            ruby: "Essential—it’s how we win.",
            pearl: "Manageable when the team is aligned.",
            emerald: "Comforting—structure keeps quality high."
          }
        },
        {
          text: "When conflict shows up, I tend to…",
          options: {
            sapphire: "Lighten the mood and keep it moving.",
            ruby: "Address it head-on and resolve it fast.",
            pearl: "Seek harmony and listen to everyone.",
            emerald: "Collect facts and clarify misunderstandings."
          }
        },
        {
          text: "If a plan changes last-minute…",
          options: {
            sapphire: "No stress—let’s improvise!",
            ruby: "Fine—what’s the fastest path to the goal now?",
            pearl: "I check in to make sure everyone’s okay.",
            emerald: "I want the details and updated timeline."
          }
        },
        {
          text: "Your desk or digital life is…",
          options: {
            sapphire: "Organized chaos—creative piles.",
            ruby: "Minimal—whatever helps me move fastest.",
            pearl: "Personal—photos, notes, reminders for people.",
            emerald: "Neat—folders, labels, templates."
          }
        },
        {
          text: "Feedback you love to hear:",
          options: {
            sapphire: "“You made this so fun.”",
            ruby: "“You crushed that goal.”",
            pearl: "“You made me feel seen.”",
            emerald: "“Your system was flawless.”"
          }
        },
        {
          text: "When learning something new…",
          options: {
            sapphire: "I jump in and figure it out as I go.",
            ruby: "I want the fastest path to mastery.",
            pearl: "I learn best with a buddy, coach, or mentor.",
            emerald: "I read the instructions and build a checklist."
          }
        },
        {
          text: "Your content or communication style naturally leans…",
          options: {
            sapphire: "Entertaining, high-energy, story-driven.",
            ruby: "Results and proof—before/after, wins, receipts.",
            pearl: "Encouraging, supportive, and heart-centered.",
            emerald: "Breakdowns, how-to’s, and data."
          }
        },
        {
          text: "Biggest demotivator for you is…",
          options: {
            sapphire: "Boredom and rigid rules.",
            ruby: "Feeling stalled or losing momentum.",
            pearl: "Tension and people getting hurt.",
            emerald: "Vague goals and sloppy execution."
          }
        },
        {
          text: "If you ran a team, your #1 priority would be…",
          options: {
            sapphire: "Keep morale and creativity high.",
            ruby: "Hit ambitious, measurable targets.",
            pearl: "Care for people and grow them.",
            emerald: "Build scalable, clear systems."
          }
        },
        {
          text: "Which compliment lands the hardest?",
          options: {
            sapphire: "“You light up the room.”",
            ruby: "“You’re unstoppable.”",
            pearl: "“You’re so thoughtful.”",
            emerald: "“You’re meticulous.”"
          }
        },
        {
          text: "Your planning tool of choice:",
          options: {
            sapphire: "Vision board / brainstorm space.",
            ruby: "Scoreboard / KPI tracker.",
            pearl: "Shared calendar / check-ins.",
            emerald: "Project management with SOPs."
          }
        },
        {
          text: "When you buy, you value…",
          options: {
            sapphire: "Experience and community.",
            ruby: "ROI and speed.",
            pearl: "Mission and trust.",
            emerald: "Specs and reliability."
          }
        }
      ]
    }
  };

  /***********************
   * STATE + ELEMENTS    *
   ***********************/
  const questions = APP_CONFIG.quiz.questions;
  const totalQuestions = questions.length;

  const questionContainer = document.getElementById("questionContainer");
  const progressText = document.getElementById("progressText");
  const progressPercent = document.getElementById("progressPercent");
  const progressFill = document.getElementById("progressFill");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const resultPanel = document.getElementById("resultPanel");
  const profileTools = document.getElementById("profileTools");

  let currentIndex = 0;
  const answers = {}; // { [index:number]: "sapphire" | "ruby" | "pearl" | "emerald" }

  function cssVar(name){
    return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
  }
  function colorForGem(key){
    const v = APP_CONFIG.gems[key]?.colorVar;
    return v ? cssVar(v) : APP_CONFIG.brand.primary;
  }

  function answeredCount(){
    return Object.keys(answers).length;
  }

  function updateProgress(){
    const a = answeredCount();
    const pct = Math.round((a / totalQuestions) * 100);
    progressText.textContent = `Question ${currentIndex + 1} of ${totalQuestions}`;
    progressPercent.textContent = `Answered ${a}/${totalQuestions} (${pct}%)`;

    // Fill shows navigation progress (not answered progress) — fixes mismatch bugs.
    const denom = Math.max(1, totalQuestions - 1);
    const navPct = Math.round((currentIndex / denom) * 100);
    progressFill.style.width = `${Math.min(100, Math.max(0, navPct))}%`;
  }

  function hideResultsIfShown(){
    if (resultPanel.style.display === "block"){
      resultPanel.style.display = "none";
      resultPanel.innerHTML = "";
      profileTools.style.display = "none";
    }
  }

  function renderQuestion(idx){
    const q = questions[idx];
    if (!q) return;

    hideResultsIfShown();
    questionContainer.innerHTML = "";

    const card = document.createElement("div");
    card.className = "card";

    const qEl = document.createElement("div");
    qEl.className = "q";
    qEl.textContent = `Q${idx + 1}. ${q.text}`;
    card.appendChild(qEl);

    const answersWrap = document.createElement("div");
    answersWrap.className = "answers";

    const keys = ["sapphire","ruby","pearl","emerald"];

    keys.forEach((key) => {
      const text = q.options[key];
      if (!text) return;

      const label = document.createElement("label");
      label.className = "answer";
      label.setAttribute("data-key", key);

      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q${idx}`;
      input.value = key;
      input.checked = answers[idx] === key;

      const span = document.createElement("span");
      span.textContent = text;

      label.appendChild(input);
      label.appendChild(span);

      if (answers[idx] === key) label.classList.add("selected");

      // Use 'change' (prevents double-fire issues on mobile label clicks)
      input.addEventListener("change", () => {
        answers[idx] = key;
        answersWrap.querySelectorAll(".answer").forEach(a => a.classList.remove("selected"));
        label.classList.add("selected");
        updateProgress();
      });

      label.addEventListener("click", (e) => {
        // clicking the label should check the radio reliably
        if (e.target !== input) input.checked = true;
        input.dispatchEvent(new Event("change", { bubbles: true }));
      });

      answersWrap.appendChild(label);
    });

    card.appendChild(answersWrap);
    questionContainer.appendChild(card);

    prevBtn.disabled = idx === 0;
    nextBtn.textContent = idx === totalQuestions - 1 ? "See My Results" : "Next";
    updateProgress();
  }

  function normalizePercents(raw){
    // raw: {k:number} where numbers may not sum to 100 due to rounding
    const keys = ["sapphire","ruby","pearl","emerald"];
    let sum = keys.reduce((s,k)=>s+(raw[k]||0),0);
    if (sum === 100) return raw;

    // Adjust the largest values up/down until sum=100 (stable + predictable)
    const out = { ...raw };
    while (sum !== 100){
      const dir = sum < 100 ? 1 : -1;
      const sorted = keys
        .slice()
        .sort((a,b)=> (out[b]||0) - (out[a]||0));
      const target = dir === 1 ? sorted[0] : sorted[sorted.length - 1];
      out[target] = Math.max(0, (out[target]||0) + dir);
      sum = keys.reduce((s,k)=>s+(out[k]||0),0);
    }
    return out;
  }

  function computeResults(){
    const counts = { sapphire:0, ruby:0, pearl:0, emerald:0 };
    for (let i=0;i<totalQuestions;i++){
      const val = answers[i];
      if (val && Object.prototype.hasOwnProperty.call(counts, val)) counts[val]++;
    }
    const total = Object.values(counts).reduce((a,b)=>a+b,0) || 1;

    const pctRaw = {};
    Object.keys(counts).forEach(k => pctRaw[k] = Math.round((counts[k] / total) * 100));
    const pct = normalizePercents(pctRaw);

    const ranking = Object.entries(pct).sort((a,b)=>b[1]-a[1]);
    const topKey = ranking[0][0];

    return { counts, pct, topKey, ranking };
  }

  function renderResults(){
    const { pct, topKey } = computeResults();
    const gem = APP_CONFIG.gems[topKey];

    resultPanel.style.display = "block";

    const barsHTML = ["sapphire","ruby","pearl","emerald"].map(k => {
      const label = APP_CONFIG.gems[k].label;
      const value = pct[k] || 0;
      const c = colorForGem(k);
      return `
        <div class="bar-row">
          <div class="bar-label">${label}</div>
          <div class="bar-shell">
            <div class="bar-fill" style="width:${value}%;background:linear-gradient(90deg, ${c}, rgba(255,255,255,0.25));"></div>
          </div>
          <div class="bar-val">${value}%</div>
        </div>
      `;
    }).join("");

    const benefitsList = gem.benefits.map(item => `<li>${item}</li>`).join("");
    const challengesList = gem.challenges.map(item => `<li>${item}</li>`).join("");
    const tipsList = gem.tips.map(item => `<li>${item}</li>`).join("");
    const howToWinList = gem.howToWin.map(item => `<li>${item}</li>`).join("");

    resultPanel.innerHTML = `
      <div class="pill">
        <span class="dot" style="background:${colorForGem(topKey)};"></span>
        TOP GEM: ${gem.label.toUpperCase()}
      </div>
      <div class="result-title">${gem.label} — ${gem.description}</div>

      <div class="section-title">Your GEMS Mix</div>
      <div class="bars">${barsHTML}</div>

      <div class="section-title">Your Natural Benefits</div>
      <ul class="bullets">${benefitsList}</ul>

      <div class="section-title">Growth Edges & Challenges</div>
      <ul class="bullets">${challengesList}</ul>

      <div class="section-title">Practical Tips</div>
      <ul class="bullets">${tipsList}</ul>

      <div class="section-title">How to Win as a ${gem.label}</div>
      <ul class="bullets">${howToWinList}</ul>

      <div class="buttons" style="margin-top:10px;">
        <button class="btn-primary" type="button" id="showShareCardBtn">Generate My Share Card</button>
      </div>
    `;

    document.getElementById("showShareCardBtn").addEventListener("click", () => {
      profileTools.style.display = "block";
      profileTools.scrollIntoView({ behavior: "smooth", block: "start" });
    });
  }

  prevBtn.addEventListener("click", () => {
    if (currentIndex > 0){
      currentIndex--;
      renderQuestion(currentIndex);
    }
  });

  nextBtn.addEventListener("click", () => {
    if (!answers[currentIndex]){
      alert("Please select an answer for this question first.");
      return;
    }
    if (currentIndex < totalQuestions - 1){
      currentIndex++;
      renderQuestion(currentIndex);
      return;
    }

    // last question
    if (answeredCount() < totalQuestions){
      alert("Please answer all questions to see your results.");
      return;
    }
    renderResults();
    resultPanel.scrollIntoView({ behavior: "smooth", block: "start" });
  });

  // Initial render (guaranteed 16 questions)
  renderQuestion(currentIndex);

  /*******************************
   * SHARE CARD (PNG GENERATOR)  *
   *******************************/
  let loadedPhoto = null;
  const photoInput = document.getElementById("photoInput");
  const makeCardBtn = document.getElementById("makeCard");
  const downloadBtn = document.getElementById("downloadCard");
  const cardPreview = document.getElementById("cardPreview");
  const cardImg = document.getElementById("cardImg");

  photoInput.addEventListener("change", (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.onload = () => { loadedPhoto = img; };
    img.onerror = () => { loadedPhoto = null; alert("Photo couldn't be loaded. Try a different image."); };
    img.src = URL.createObjectURL(file);
  });

  function wrapText(ctx, text, x, y, maxWidth, lineHeight, maxLines){
    const words = (text || "").split(/\s+/).filter(Boolean);
    const lines = [];
    let line = "";

    for (let i=0;i<words.length;i++){
      const test = line ? (line + " " + words[i]) : words[i];
      if (ctx.measureText(test).width > maxWidth && line){
        lines.push(line);
        line = words[i];
        if (maxLines && lines.length >= maxLines) break;
      } else {
        line = test;
      }
    }
    if ((!maxLines || lines.length < maxLines) && line) lines.push(line);

    lines.forEach((ln, i) => ctx.fillText(ln, x, y + i * lineHeight));
    return y + (lines.length * lineHeight);
  }

  function roundRect(ctx, x, y, w, h, r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr, y);
    ctx.lineTo(x+w-rr, y);
    ctx.quadraticCurveTo(x+w, y, x+w, y+rr);
    ctx.lineTo(x+w, y+h-rr);
    ctx.quadraticCurveTo(x+w, y+h, x+w-rr, y+h);
    ctx.lineTo(x+rr, y+h);
    ctx.quadraticCurveTo(x, y+h, x, y+h-rr);
    ctx.lineTo(x, y+rr);
    ctx.quadraticCurveTo(x, y, x+rr, y);
    ctx.closePath();
  }

  function drawShareCard(data, photo){
    const { pct, topKey } = data;
    const gem = APP_CONFIG.gems[topKey];

    const W = 1080, H = 1350, pad = 60;
    const CX = pad, CY = pad, CW = W - pad*2, CH = H - pad*2;

    const canvas = document.createElement("canvas");
    canvas.width = W; canvas.height = H;
    const ctx = canvas.getContext("2d");

    // Background
    const bg = ctx.createLinearGradient(0,0,W,H);
    bg.addColorStop(0,"#1a1224");
    bg.addColorStop(1,"#07060a");
    ctx.fillStyle = bg;
    ctx.fillRect(0,0,W,H);

    // Card
    ctx.fillStyle = "rgba(0,0,0,0.68)";
    ctx.strokeStyle = "rgba(255,255,255,0.22)";
    ctx.lineWidth = 2;
    roundRect(ctx, CX, CY, CW, CH, 34);
    ctx.fill(); ctx.stroke();

    // Photo circle (spacing fixed: pushed right, with consistent padding + safe stroke)
    const P = 240;
    const pX = CX + CW - P - 44;
    const pY = CY + 44;

    // Header text area (avoid colliding with photo)
    const headerMaxW = (pX - (CX + 44)) - 18;

    ctx.fillStyle = "#ffffff";
    ctx.font = "900 52px " + APP_CONFIG.brand.fontFamily;
    wrapText(ctx, "TELEZA REEVES", CX + 44, CY + 92, headerMaxW, 56, 1);

    ctx.font = "700 34px " + APP_CONFIG.brand.fontFamily;
    ctx.fillStyle = APP_CONFIG.brand.primarySoft;
    wrapText(ctx, ("TOP GEM: " + gem.label).toUpperCase(), CX + 44, CY + 140, headerMaxW, 40, 1);

    // Clip circle + draw photo
    ctx.save();
    ctx.beginPath();
    ctx.arc(pX + P/2, pY + P/2, P/2, 0, Math.PI*2);
    ctx.closePath();
    ctx.clip();
    ctx.fillStyle = "#222";
    ctx.fillRect(pX, pY, P, P);

    if (photo){
      const ar = photo.width / photo.height;
      let sx=0, sy=0, sw=photo.width, sh=photo.height;
      if (ar > 1){
        sw = photo.height;
        sx = (photo.width - sw) / 2;
      } else {
        sh = photo.width;
        sy = (photo.height - sh) / 2;
      }
      ctx.drawImage(photo, sx, sy, sw, sh, pX, pY, P, P);
    }
    ctx.restore();

    // Circle stroke
    ctx.strokeStyle = "rgba(255,255,255,0.40)";
    ctx.lineWidth = 5;
    ctx.beginPath();
    ctx.arc(pX + P/2, pY + P/2, (P/2) - 1.5, 0, Math.PI*2);
    ctx.stroke();

    // Mix header
    let y = CY + 230;
    ctx.fillStyle = "#ffffff";
    ctx.font = "800 32px " + APP_CONFIG.brand.fontFamily;
    ctx.fillText("YOUR GEMS MIX", CX + 44, y);

    const keys = ["sapphire","ruby","pearl","emerald"];
    const startX = CX + 44;
    const labelW = 165;
    const pctW = 60;
    const gap = 18;
    const barX = startX + labelW;
    const barW = Math.max(340, (pX - 22) - barX - pctW); // keeps bars consistent + avoids photo overlap
    const barH = 26;

    y += 30;

    keys.forEach((key) => {
      const lab = APP_CONFIG.gems[key].label;
      const value = pct[key] || 0;
      const gemColor = colorForGem(key);

      y += 56;

      ctx.font = "700 24px " + APP_CONFIG.brand.fontFamily;
      ctx.fillStyle = "#e6e6e6";
      ctx.fillText(lab, startX, y);

      ctx.fillStyle = "rgba(255,255,255,0.10)";
      roundRect(ctx, barX, y - 22, barW, barH, 13);
      ctx.fill();

      const w = Math.max(10, Math.round((barW * value) / 100));
      const g = ctx.createLinearGradient(barX, y - 22, barX + w, y - 22);
      g.addColorStop(0, gemColor);
      g.addColorStop(1, "rgba(255,255,255,0.35)");
      ctx.fillStyle = g;
      roundRect(ctx, barX, y - 22, w, barH, 13);
      ctx.fill();

      ctx.font = "800 22px " + APP_CONFIG.brand.fontFamily;
      ctx.fillStyle = "#ffffff";
      ctx.fillText(value + "%", barX + barW + gap, y - 2);
    });

    // How to win (more tips, not just 1)
    y += 74;
    ctx.font = "900 30px " + APP_CONFIG.brand.fontFamily;
    ctx.fillStyle = "#ffffff";
    ctx.fillText("HOW TO WIN AS A " + gem.label.toUpperCase(), CX + 44, y);

    ctx.font = "500 22px " + APP_CONFIG.brand.fontFamily;
    ctx.fillStyle = "#dcdcdc";
    const tips = (gem.howToWin || []).slice(0, 3);
    let ty = y + 30;
    tips.forEach((t) => {
      ctx.fillText("•", CX + 44, ty);
      ty = wrapText(ctx, t, CX + 64, ty, CW - 88, 30, 3) + 8;
    });

    // Bottom identity (brandTag spacing fixed: explicit line separation + safe trim)
    const nameVal = (document.getElementById("displayName").value || "").trim();
    const tagVal = (document.getElementById("brandTag").value || "").trim();
    const bottomY = H - 122;

    if (nameVal){
      ctx.font = "900 30px " + APP_CONFIG.brand.fontFamily;
      ctx.fillStyle = "#ffffff";
      ctx.fillText(nameVal, CX + 44, bottomY);
    }
    if (tagVal){
      ctx.font = "700 24px " + APP_CONFIG.brand.fontFamily;
      ctx.fillStyle = "#d0d0d0";
      ctx.fillText(tagVal, CX + 44, bottomY + 34);
    }

    // Bottom rule + footer text
    const lineY = H - 64;
    ctx.strokeStyle = APP_CONFIG.brand.primary;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(CX + 44, lineY);
    ctx.lineTo(CX + CW - 44, lineY);
    ctx.stroke();

    ctx.font = "900 22px " + APP_CONFIG.brand.fontFamily;
    ctx.fillStyle = APP_CONFIG.brand.primary;
    ctx.fillText("TELEZA REEVES • GEMS PERSONALITY", CX + 52, lineY - 14);

    return canvas;
  }

  makeCardBtn.addEventListener("click", () => {
    // Guard: don’t generate a “half-quiz” card by accident
    if (answeredCount() < totalQuestions){
      alert("Please finish all questions and view your results before generating a share card.");
      return;
    }
    const { pct, topKey } = computeResults();
    const canvas = drawShareCard({ pct, topKey }, loadedPhoto);
    const url = canvas.toDataURL("image/png");

    cardImg.src = url;
    cardPreview.style.display = "block";
    downloadBtn.style.display = "inline-block";

    downloadBtn.onclick = () => {
      const link = document.createElement("a");
      link.href = url;
      link.download = "teleza-reeves-gems-card.png";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };
  });
</script>
</body>
</html>
